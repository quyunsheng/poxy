<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/swiper.min.css" />
		<link rel="stylesheet" type="text/css" href="css/qys/shop.css" />
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			[v-cloak]{
			    display: none;
			}
			.mb{
				display: none;
			}
			.alert-phoneBox{
				display: flex;
				align-items: center;
				justify-content: center;
				position: absolute;
				left: 50%;
				margin-left: -150px;
				top:30%;
				width:300px;
				height: 150px;
				background: #fff;
			}

		</style>
	</head>
	<body>
		<div id="shop" v-cloak>
			<div class="headerpage"></div>
			<div class="main-width">
				<img class="shop-banner" src="images/shop/shop-banner.png">
				<ul class="shop-nav">
					<li><a href="index.html">首页</a></li>
					<li v-for="item in navList"><a @click="thizType(item.key)">&nbsp;&gt;&nbsp;{{item.value}}</a></li>
				</ul>
				<div class="good-detail clearfix">
					<div class="good-l fl">
						<div class="bigImg swiper-container">
							<div class="swiper-wrapper">
								<div class="swiper-slide" v-for="item in imgList" v-model="nowGg">
									<img :src="item.url">
								</div>
							</div>
						</div>
						<div class="bigImg-list">
							<div class="imgSwiper swiper-container">
								<div class="swiper-wrapper">
									<div class="swiper-slide" v-for="item in imgList" v-model="nowGg">
										<img :src="item.url">
									</div>
								</div>
							</div>
							<div class="swiper-button-next"></div>
							<div class="swiper-button-prev"></div>
						</div>
						<div class="good-operate">
							<!-- <span @click="addCollects"><img class="gray" src="images/shop/collect.png">加入收藏</span> -->
							<!--<span><img src="images/shop/kf.png">在线咨询</span>-->
						</div>
					</div>
					<div class="good-r fr">
						<h3>{{goodsDetail.name}}</h3>
						<div class="good-price" v-if="!getUsers.discount">
							价格：<a>￥</a><i>{{goodsDetail.price}}</i>
						</div>
						<div class="good-price" v-if="getUsers.discount">
							价格：<a>￥</a><i>{{goodsDetail.price * getUsers.discount}}</i><b style="text-decoration: line-through;">{{goodsDetail.price}}</b><span v-if="!getUsers.discount">会员享更多折优惠</span>
						</div>
						<div class="good-num">
							<span>库存：<i>{{goodsDetail.totalStock}}</i></span>
							<!-- <a>|</a>
							<span>起订量：<i>10000</i></span> -->
							<a>|</a>
							<span>累计成交：<i>{{goodsDetail.salesVolume}}笔</i></span>
						</div>
						<p class="freight">运费：<i>{{goodsDetail.freightType == 0 ? '包邮' : (goodsDetail.freightType == 1 ? goodsDetail.freight : '待商议')}}</i>(付款成功后48小时内安排发货)</p>
						<div class="good-type">
							<i>规格：</i>
							<span v-for='item in goodsDetail.specsList' @click="changeGG(item,item.id)" :class="{checked:item.id == nowGg}">{{item.name}}</span>
						</div>
						<p class="good-size" v-if="isShowGG">
							参数：
							<span>{{ggList.price}}元(单价)</span>
							<span>{{ggList.stock}}(库存)</span>
							<span class="size-num">
								<i @click="reduce()">-</i>
								<input type="text" name="" value="1" v-model="num" @change="calculate(ggList)" />
								<i @click="add(ggList)">+</i>
							</span>
						</p>
						<div class="good-btn">
							<!-- <span class="btn-cart" @click="addCart(ggList.id)">加入购物车</span> -->
							<!-- <span class="btn-buy" @click="addOrder(ggList.id)">立即订购</span> -->
							<span class="btn-buy" @click="showBox">立即咨询</span>
						</div>
					</div>
				</div>
				<!-- 商家推荐 -->
				<p class="recommend">商家推荐</p>
				<div class="good-recommend clearfix">
					<div class="recommend-list" v-for="(item,index) in shopRecGood.slice(0,5)" @click="goodDetail(item.id,item.classifyCode)">
						<div class="goods-img">
							<img :src="item.logo">
						</div>
						<h4>{{item.name}}</h4>
						<p>￥<i>{{item.price}}</i></p>
						<span>已售：{{item.salesVolume}}瓶</span>
					</div>
				</div>
				<!-- 详情 -->
				<div class="good-btm clearfix">
					<div class="merchant-box fl">
						<div class="merchant-name"><img src="images/shop/merchant.png">{{storeDetail.name}}</div>
						<div class="merchant-cont" style="padding: 20px;">
							<p>主营产品：{{storeDetail.summary}}</p>
							<p>公司地址：{{storeDetail.address}}</p>
							<i class="merchant-line"></i>
							<p>联系人：{{storeDetail.realname}}</p>
							<p>电话：{{storeDetail.cellPhone}}</p>
							<p v-if="storeDetail.spareName">紧急联系人：{{storeDetail.spareName}}</p>
							<p v-if="storeDetail.sparePhone">紧急联系人电话：{{storeDetail.sparePhone}}</p>
						</div>
						<div class="clearfix">
							<div class="go-merchant">
								<a @click="shopDetail(storeDetail.id)">
									<img src="images/shop/shop.png">
									<p>进入店铺</p>
								</a>
							</div>
							<div class="go-kf">
								<a :href="token == '' ? outLink : ['http://wpa.qq.com/msgrd?v=3&uin='+ storeDetail.csdQQ +'&site=qq&menu=yes']">
									<img src="images/shop/kf.png">
									<p>在线咨询</p>
								</a>
							</div>
						</div>
					</div>
					<div class="detail-box fr">
						<div class="detail-type">
							<span @click="changeTab(1)">产品详情</span>
							<!-- <span>累计成交(80笔)</span> -->
							<span @click="changeTab(2)">订购说明</span>
							<span @click="changeTab(3)">视频说明</span>
						</div>
						<div class="detail-mage" v-html="goodsDetail.description" v-if="changeNum == 1"></div>
						<div class="detail-mage" v-html="" v-if="changeNum == 2"></div>
						<div class="detail-mage" v-html="" v-if="changeNum == 3">
							<video width="100%" controls>
								<source :src="goodsDetail.video" type="video/mp4">
								</source>
							</video>
						</div>
					</div>
				</div>
			</div>
			<div class="mb" @click="close">
				<div class="alert-phoneBox">
					电话：{{storeDetail.cellPhone}}
				</div>
			</div>
		</div>
		<div class="footerpage"></div>
		<script src="js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/qs.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/axios.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/request.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/qu-js/urls.js" type="text/javascript" charset="utf-8"></script>
		<script>
			$(function() {
				$(".headerpage").load("header.html");
				$(".footerpage").load("footer.html?vid=0717");
			});
		</script>
		<script type="text/javascript">
			new Vue({
				el: '#shop',
				data() {
					return {
						getUsers: '',
						token: '',
						navList: '', // 级别导航
						childType: '', // 子集type列表
						goodsDetail: '', //商品详情
						storeDetail:'',//店铺详情
						shopRecGood: '', //店铺推荐商品
						isShowGG: false,
						outLink:'javascript:;',
						shopId: localStorage.getItem(goodsId),
						classifyCode: localStorage.getItem(storeId),
						oldPrice: '', //初始价格
						oldImg: '', //初始商品图
						imgList: '', //轮播图容器
						ggList: '', //规格容器
						num: 1, //商品数量
						nowGg: '', //当前选中规格
						chooseShop:'',//创建订单提交值
						changeNum:1,//产品详情、订购说明
						isLogin: false, //显示登录
						isMb:false,//显示蒙版
					}
				},
				methods: {
					// 获取用户信息
					showBox:function(){
						$('.mb').show()
					},
					close:function(){
						$('.mb').hide()
					},

					getPeople: function() {
						this.token = localStorage.getItem(tkn);
						axios.get(allUrl.getUser, {
							headers: {
								Authorization: this.token,
								Accept: 'application/json',
							},
						}).then((response) => {
							if (response != "" && response.code == 0) {
								this.getUsers = response.data
							}
							if (response.code == 7) {
								alert('请先登录！')
								this.isLogin = true
								this.isMb = true
								return false
							}
						})
					},
					// 获取商品详情
					getDetail: function() {
						axios.get(allUrl.getgoodDetail, {
							params: {
								productId: this.shopId
							},
						}).then((response) => {
							if (response != "" && response.code == 0) {
								this.goodsDetail = response.data
								this.imgList = response.data.picList
								this.oldImg = response.data.picList
								this.oldPrice = response.data.price
								this.getShopGood(response.data.businessId)
								this.mySwiper();
								this.getGoodStore();
							}
						})
					},
					//获取店铺详情
					getGoodStore:function(){
						axios.get(allUrl.getStore, {
							params: {
								businessId: this.goodsDetail.businessId,
							},
						}).then((response) => {
							if (response != "" && response.code == 0) {
								this.storeDetail = response.data
							}
						})
					},
					// 获取导航级别
					getNav: function() {
						axios.get(allUrl.getShopNav, {
							params: {
								classifyCode: this.classifyCode,
							},
						}).then((response) => {
							if (response != "" && response.code == 0) {
								this.navList = response.data
							}
						})
					},
					// 点击分类导航
					thizType: function(code) {
						localStorage.setItem(storeId, code);
						window.location.href = 'shop.html'
					},
					add(item) {
						this.num++
						if(item.num >item.stock){
							alert('最大值不能超过库存!')
							item.num--
							return false
						}
					},
					reduce() {
						if (this.num == 1) return
						this.num--
					},
					//输入框改变价格变动
					calculate(item) {
						let myPrice = /^[1-9]\d*$/;
						if(!myPrice.test(this.num)){
							alert('请输入正确的数量！')
							this.num = 1
						}
						if(this.num > item.stock){
							alert('最大值不能超过库存！')
							this.num = item.stock
						}
					},
					// 获取店铺推荐商品
					getShopGood: function(bisId) {
						axios.get(allUrl.getRecGood, {
							params: {
								pageSize:5,
								productId: this.shopId
							},
						}).then((response) => {
							if (response != "" && response.code == 0) {
								this.shopRecGood = response.data
							}
						})
					},
					// 跳转商品详情
					goodDetail:function(goGoodId,comtIds){
						localStorage.setItem(goodsId,goGoodId);
						localStorage.setItem(storeId,comtIds);
						window.location.href = 'shop-detail.html'
					},
					// 跳转店铺页
					shopDetail:function(goShopId){
						localStorage.setItem(shopsId,goShopId);
						window.location.href = 'shop-store.html'
					},
					// 选择规格
					changeGG: function(item, ggId) {
						if (this.nowGg == ggId) {
							this.nowGg = ''
							this.imgList = this.oldImg
							this.goodsDetail.price = this.oldPrice
							this.isShowGG = false
							this.mySwiper();

						} else {
							this.imgList = ''
							this.imgList = item.list
							this.goodsDetail.price = item.price
							this.ggList = item
							this.isShowGG = true
							this.nowGg = ggId;
							this.mySwiper();
						}
					},
					mySwiper: function() {
						var galleryThumbs = new Swiper('.imgSwiper', {
							spaceBetween: 10,
							slidesPerView: 5,
							freeMode: true,
							watchSlidesVisibility: true,
							watchSlidesProgress: true,
							observer: true, //修改swiper自己或子元素时，自动初始化swiper
							observeParents: true //修改swiper的父元素时，自动初始化swiper
						});
						var galleryTop = new Swiper('.bigImg', {
							spaceBetween: 10,
							navigation: {
								nextEl: '.swiper-button-next',
								prevEl: '.swiper-button-prev',
							},
							thumbs: {
								swiper: galleryThumbs
							},
							observer: true, //修改swiper自己或子元素时，自动初始化swiper
							observeParents: true //修改swiper的父元素时，自动初始化swiper
						});
					},
					changeTab:function(num){
						this.changeNum = num
					},
					//判断是否登录
					findLogin:function(){
						if(!this.token){
							alert('请先登录！')
							this.isLogin = true
							this.isMb = true
							return false
						}
					},
					// 登录
					logRest: function(num) {
					
					    // 0登录1注册2验证码登录3忘记密码
					    // 显示on:showOn:0登录showOn:1注册
					    if (num == 0) {
					        this.showLogin = true;
					        this.showCode = false;
					        this.showReg = false;
					        this.showForget = false;
					        this.showOn = 0;
					    } else if (num == 1) {
					        this.showLogin = false;
					        this.showCode = false;
					        this.showReg = true;
					        this.showForget = false;
					        this.showOn = 1;
					    } else if (num == 2) {
					        this.showLogin = false;
					        this.showCode = true;
					        this.showReg = false;
					        this.showForget = false;
					        this.showOn = 2;
					    } else if (num == 3) {
					        this.showLogin = false;
					        this.showCode = false;
					        this.showReg = false;
					        this.showForget = true;
					        this.showOn = 2;
					    }
					    this.phone = ''
					    this.pass = ''
					    this.code = ''
					},
					// 登录
					loginType: function() {
					    let mylog = /^[1][3,4,5,7,8][0-9]{9}$/;
					    let mypass = /^[a-zA-Z0-9_-]{6,16}$/;
					    if (!mylog.test(this.phone)) {
					        alert("对不起，请填写正确的手机号!");
					        return false
					    }
					    if (this.pass == '') {
					        alert("请填写密码!");
					        return false
					    }
					    if (!mypass.test(this.pass)) {
					        alert("密码格式错误!");
					        return false
					    }
					    const myJson = {
					        phone: this.phone,
					        password: this.pass
					    }
					    axios.post(allUrl.userLogin, myJson, ).then((result) => {
					        if (result != "" && result.code == 0) {
					            localStorage.setItem(tkn, result.data);
					            window.location.href = 'index.html'
					        }
					    }).catch((error) => {
					        //alert(error.message)
					    })
					},
					// 验证码登录
					codeLoginType: function() {
					    let mylog1 = /^[1][3,4,5,7,8][0-9]{9}$/;
					    if (!mylog1.test(this.phone)) {
					        alert("对不起，请填写正确的手机号!");
					        return false
					    }
					    const myJson = {
					        phone: this.phone,
					        code: this.code
					    }
					    axios.post(allUrl1.codeLogin, myJson, ).then((result) => {
					        if (result != "" && result.code == 0) {
					            localStorage.setItem(tkn, result.data);
					            window.location.href = 'index.html'
					        }
					    }).catch((error) => {
					        //alert(error.message)
					    })
					},
					// 注册
					regiseType: function() {
					    let mylog = /^[1][3,4,5,7,8][0-9]{9}$/;
					    let mypass = /^[a-zA-Z0-9_-]{6,16}$/;
					    if (!mylog.test(this.phone)) {
					        alert("对不起，请填写正确的手机号!");
					        return false
					    }
					    if (this.code == '') {
					        alert("请填写验证码!");
					        return false
					    }
					    if (this.pass == '') {
					        alert("请填写密码!");
					        return false
					    }
					    if (this.passVerify == '') {
					        alert("请确认密码!");
					        return false
					    }
					    if (this.pass != this.passVerify) {
					        alert("两次密码输入不一致!");
					        return false
					    }
					    if (!mypass.test(this.pass)) {
					        alert("密码格式错误!");
					        return false
					    }
					    const myJson = {
					        phone: this.phone,
					        password: this.pass,
					        checkCode: this.code, //验证码
					        nickname: 'sj' + this.phone, // 用户昵称
					        headImg: this.headImg // 用户头像
					    }
					    axios.post(allUrl.userRegist, myJson)
					        .then((result) => {
					            if (result != "" && result.code == 0) {
					                this.showLogin = true;
					                this.showReg = false;
					                this.showOn = 0;
					                this.pass = '';
					            }
					        }).catch((error) => {
					            alert("页面错误： " + error.message)
					        })
					},
					// 获取验证码
					getCode: function() {
					    var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
					    let _thiz = this
					    if (this.phone == "" || this.phone == "undefined" || this.phone == null || this.phone ==
					        "null" || !myreg.test(this.phone)) {
					        alert("请填写正确的手机号");
					        return false
					    }
					    if (_thiz.codeText == "获取验证码") {
					        const myJson = {
					            phone: _thiz.phone,
					        }
					        axios.post(allUrl1.getCodeNum, myJson, {
					            headers: {
					                Accept: 'application/json',
					            }
					        }).then((result) => {
					            if (result != "" && result.code == 0) {
					                var time = 60;
					                var timer = setInterval(function() {
					                    time--;
					                    _thiz.myCode = 1;
					                    _thiz.codeText = time + "秒重发";
					                    if (time == 0) {
					                        clearInterval(timer);
					                        _thiz.codeText = "获取验证码";
					                        _thiz.myCode = '0';
					                    }
					                }, 1000);
									if(_thiz.myCode == 1){
										 $(".tableText").attr("disabled", "disabled");
									}else{
										$(".tableText").removeAttr("disabled");
									}
					            }
					        }).catch((error) => {
					            //alert(error.message)
					        })
					    }
					},
					
				},
				mounted() {
					this.token = localStorage.getItem(tkn);
					if (this.token && this.token != 'null' && this.token != 'undefined') {
						this.getPeople();
					}
					this.getNav();
					this.getDetail();
				}
			})
		</script>

	</body>
</html>
