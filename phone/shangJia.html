<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/footer.css"/>
    <link rel="stylesheet" type="text/css" href="css/reset.css"/>
    <link rel="stylesheet" type="text/css" href="css/swiper.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/fang-css/shangJia.css"/>
    <link rel="stylesheet" href="css/ljj-css/shop.css">
    <script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/phone.js" type="text/javascript" charset="utf-8"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <script src="js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/request.js"></script>
    <script src="js/qs.min.js"></script>
    <script src="js/ljj-js/urls.js"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=63W4wCS4i4SEEmKbNqLuzV55zOy1enim"></script>
</head>
<body>
<div id="store" style="padding-bottom: 2rem;">
    <div class="lwxq_title">
        <div class="lwxq_title_txt">
            <a href="phone.html"><img src="img/q-img/home.png"></a>
            <a>{{storeDetail.name}}</a>
            <a href="cpfl.html" class="delateSome"><img src="img/fang-img/serchWhite.png"></a>
        </div>
    </div>
    <!-- main -->
    <div class="store-swiper swiper-container swiperBox">
        <div class="swiper-wrapper">
            <div class="swiper-slide" v-for="item in storeDetail.list">
                <a href="#">
                    <img :src="item.url">
                </a>
            </div>
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
    </div>
    <!-- 优惠券-->
    <!-- <div class="contentP" @click="couponClick"><p class="coupon-btn2">领取优惠券</p></div> -->
    <div></div>
    <!-- 新品推荐 -->
    <div class="contentP"><p>新品推荐</p></div>

    <div class="wdscMain">
        <div class="wdscList" @click="goodDetail(item.id,item.classifyCode)" v-for="item in remGoods.slice(0,4)">
            <img :src="item.logo">
            <p>{{item.name}}</p>
            <span>已售：{{item.salesVolume}}</span>
            <p>￥{{item.price}}</p>
        </div>
    </div>
    <div class="mb" :class="{block:screenMd}" @click="md"></div>
    <div class="coupon-box" :class="{block:couponBox}">
        <div class="coupon-list" v-for="item in couponList">
            <i>￥</i>
            <span>{{item.amount}}</span>
            <div class="">
                <!--<p class="coupon-t">优惠券</p>-->
                <p>订单满{{item.fullDecrement}}元可用</p>
                <a @click="getAcoupon(item.id)">立即领取</a>
            </div>
        </div>
    </div>
	<div style="padding: 0.2rem;">
		<div v-if="this.lng" id="allmap" style="height: 300px;"></div>
	</div>
    <div class="pageFooter">
        <div class="hotListMainF">
            <a href="shangJia.html">
                <div class="footPic"><img :src="storeDetail.logo"></div>
            </a>
        </div>
        <div class="hotListMainF">
            <a href="cpfl.html">
                <p><img src="img/fang-img/icon-fl2.png"></p>
                <p>产品分类</p>
            </a>
        </div>
        <div class="hotListMainF">
            <a href="dpzz.html">
                <p><img src="img/fang-img/icon-zz.png"></p>
                <p>商家资质</p>
            </a>
        </div>
        <div class="hotListMainF">
            <a :href="token == '' ? outLink : ['http://wpa.qq.com/msgrd?v=3&uin='+ storeDetail.csdQQ +'&site=qq&menu=yes']">
                <p><img src="img/fang-img/icon-lxkf.png"></p>
                <p>联系客服</p>
            </a>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    localStorage.removeItem(searchGood);
    new Vue({
        el: '#store',
        data() {
            return {
                getUsers: '',
                token: '',
                outLink: 'javascript:;',
                businessId: localStorage.getItem(shopsId),
                storeDetail: '',//店铺详情
                remGoods: '',//店铺推荐商品
                couponList: '',//店铺优惠券
                storeType: '',//店铺商品分类
                screenMd: false,//遮罩层
                couponBox: false,//优惠券orderId
				lng:'',
				lat:'',
            }
        },
        methods: {
            // 获取用户信息
            getPeople: function () {
                this.token = localStorage.getItem(tkn);
                axios.get(allUrl.getUser, {
                    headers: {
                        Authorization: this.token,
                        Accept: 'application/json',
                    },
                }).then((response) => {
                    if (response != "" && response.code == 0) {
                        this.getUsers = response.data
                    } else {
                        alert(response.message)
                        window.location.href = 'i-login.html';
                    }
                })
            },
            //获取店铺详情
            getGoodStore: function () {
                axios.get(allUrl.getStore, {
                    params: {
                        businessId: this.businessId,
                    },
                }).then((response) => {
                    if (response != "" && response.code == 0) {
                        this.storeDetail = response.data
						this.lng = response.data.mapX
						this.lat = response.data.mapY
						this.$nextTick(()=>{
							this.mySwiper();
							if(this.lng){
								this.setmap(this.lng,this.lat)
							}
						})
                    } else {
                        alert(response.message)
                    }
                })
            },
			// 加载百度地图
			setmap: function(mapX,mapY) {
				let _thiz = this
				map = new BMap.Map('allmap', {
					enableMapClick: true
				}); // 创建Map实例
				map.centerAndZoom(new BMap.Point(mapX, mapY), 11); // 初始化地图,设置中心点坐标和地图级别
				//添加地图类型控件
				map.addControl(new BMap.MapTypeControl({
					mapTypes: [
						BMAP_NORMAL_MAP,
						BMAP_HYBRID_MAP
					]
				}));
				map.setCurrentCity("北京"); // 设置地图显示的城市 此项是必须设置的
				map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
				//设置标注的图标
				var icon = new BMap.Icon("img/q-img/map.png",new BMap.Size(100,100));
				//设置标注的经纬度
				var marker = new BMap.Marker(new BMap.Point(mapX, mapY),{icon:icon});
				//把标注添加到地图上
				map.addOverlay(marker);
				var content = "<table>";
				content = content + "<tr><td>名称："+ this.storeDetail.name +"</td></tr>";
				content = content + "<tr><td> 地点："+ this.storeDetail.address +"</td></tr>";
				content = content + "<tr><td> 电话："+ this.storeDetail.cellPhone +"</td></tr>";
				content += "</table>";
				var infowindow = new BMap.InfoWindow(content);
				marker.addEventListener("click",function(){
					this.openInfoWindow(infowindow);
				});
			
			},
            //获取店铺商品分类
            getStoreType: function () {
                axios.get(allUrl.getStoreCode, {
                    params: {
                        businessId: this.businessId,
                    },
                }).then((response) => {
                    if (response != "" && response.code == 0) {
                        this.storeType = response.data
                    } else {
                        alert(response.message)
                    }
                })
            },
            //遮罩层
            md: function () {
                this.screenMd = false;
                this.couponBox = false;
            },
            // 获取推荐商品
            getGoods: function () {
                axios.get(allUrl.bestGoods, {
                    params: {
                        pageSize: 10,
                        businessId: this.businessId
                    }
                }).then((response) => {
                    if (response != "" && response.code == 0) {
                        this.remGoods = response.data;
                        if (response.data.length > 5) {
                            var goodSwiper = new Swiper('.goods-swiper', {
                                slidesPerView: 5,
                                spaceBetween: 15,
                                autoplay: {
                                    delay: 2000,
                                    stopOnLastSlide: false,
                                    disableOnInteraction: false,
                                },
                                navigation: {
                                    nextEl: '.goods-right',
                                    prevEl: '.goods-left',
                                },
                                loop: true,
                                observer: true, //修改swiper自己或子元素时，自动初始化swiper
                                observeParents: true //修改swiper的父元素时，自动初始化swiper
                            });
                        } else {
                            $('.goods-btn').hide();
                            var goodSwiper = new Swiper('.goods-swiper', {
                                slidesPerView: 5,
                                spaceBetween: 15,
                                navigation: {
                                    nextEl: '.goods-right',
                                    prevEl: '.goods-left',
                                },
                                observer: true, //修改swiper自己或子元素时，自动初始化swiper
                                observeParents: true //修改swiper的父元素时，自动初始化swiper
                            });
                        }
                    } else {
                        alert(response.message);
                    }
                })
            },
            // 跳转店铺商品
            lookGood: function (code, model) {
                // localStorage.setItem(shopsId, this.businessId);
                localStorage.setItem(classifyCode, code);
                localStorage.setItem(typeModel, model);
                if (model == 0) {
                    window.location.href = 'shop-store-tab.html';
                }
                if (model == 1) {
                    window.location.href = 'shop-store-good.html';
                }
            },
            mySwiper: function () {
                var headSwiper = new Swiper('.store-swiper', {
                    loop: true,
                    autoplay: {
                        delay: 2000,
                        stopOnLastSlide: false,
                        disableOnInteraction: false,
                    },
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                    },
                    observer: true, //修改swiper自己或子元素时，自动初始化swiper
                    observeParents: true, //修改swiper的父元素时，自动初始化swiper
                });
            },
            // 跳转商品详情
            goodDetail: function (id, code) {
                window.location.href = 'good-detail.html?id='+id+'&code='+code;
            },
        },
        mounted() {
            this.token = localStorage.getItem(tkn);
            if (this.token && this.token != 'null' && this.token != 'undefined') {
                this.getPeople();
            }
            this.getGoodStore();
            this.getStoreType();
            this.getGoods();
        }
    })
</script>
</html>